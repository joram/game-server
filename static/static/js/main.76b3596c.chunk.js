(this.webpackJsonpgame=this.webpackJsonpgame||[]).push([[0],{11:function(t,e,n){t.exports=n(25)},16:function(t,e,n){},17:function(t,e,n){},25:function(t,e,n){"use strict";n.r(e);var a=n(0),o=n.n(a),s=n(7),i=n.n(s),c=(n(16),n(2)),r=n(1),l=n(4),u=n(3),h=n(8),p=n.n(h),d=(n(17),n(9)),v=n.n(d),y=n(10),f=n.n(y);function b(){var t=window.location.href.split("/")[2];return"localhost:3000"===t?"localhost:2305":t}function g(){return"localhost:2305"===b()?"ws":"wss"}function k(){return"localhost:2305"===b()?"http":"https"}var m=function(t){Object(l.a)(n,t);var e=Object(u.a)(n);function n(){var t;Object(c.a)(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(t=e.call.apply(e,[this].concat(o))).state={id:void 0,playerPosition:{x:0,y:0}},t.debouncedMovePlayer=v.a.debounce((function(e,n,a){t.movePlayer(e,n)}),350,{leading:!0,maxWait:350}),t}return Object(r.a)(n,[{key:"sendAccessToken",value:function(t,e){var n='{"accessToken":"'.concat(t,'", "googleId":"').concat(e,'"}');this.ws.send(n)}},{key:"sendPlayerMove",value:function(t){var e='{"direction":"'.concat(t,'"}');this.ws.send(e)}},{key:"componentDidMount",value:function(){var t=this,e="".concat(g(),"://").concat(b(),"/objects");console.log(e),this.ws=new WebSocket(e),this.ws.onopen=function(){console.log("connected to objects ws"),t.sendAccessToken(t.props.accessToken,t.props.googleId)},this.ws.onmessage=function(e){var n=JSON.parse(e.data),a=n.playerId;if(void 0!==a){var o=t.state;o.id=a,t.setState(o)}else if(t.props.objectEventBus.emit("object-update",null,n),n.id===t.state.id){var s=t.state;s.playerPosition.x=n.x,s.playerPosition.y=n.y,t.setState(s)}var i=t.state,c=i.playerPosition;if("player"===n.type){i.playerPosition=c,i.nextPlayerPosition=c,t.setState(i),t.props.background.current.updateChunks();var r=t.props.app.state;r.playerPosition=c,t.props.app.setState(r)}},this.ws.onclose=function(){console.log("disconnected")}}},{key:"movePlayer",value:function(t,e){"w"===t&&(t="up"),"a"===t&&(t="left"),"s"===t&&(t="down"),"d"===t&&(t="right"),this.props.background.current.updateChunks(),this.sendPlayerMove(t)}},{key:"render",value:function(){var t=this;return o.a.createElement(o.a.Fragment,null,o.a.createElement(f.a,{handleKeys:["left","right","up","down","w","a","s","d"],onKeyEvent:function(e,n){t.debouncedMovePlayer(e,n,100)}}),this.props.children)}}]),n}(o.a.Component),j=n(5),E=function(t){Object(l.a)(n,t);var e=Object(u.a)(n);function n(){return Object(c.a)(this,n),e.apply(this,arguments)}return Object(r.a)(n,[{key:"isSolid",value:function(){return this.props.pixel.g>180}},{key:"render",value:function(){var t=this.props.pixel,e="rgb(".concat(t.r,", ").concat(t.g,", ").concat(t.b,")");return this.isSolid()&&(e="rgb(0, 80, 0)"),o.a.createElement("div",{style:{width:"50px",height:"50px",left:"".concat(50*(t.x-this.props.chunkPosition.x),"px"),top:"".concat(50*(t.y-this.props.chunkPosition.y),"px"),backgroundColor:e,position:"absolute"}})}}]),n}(o.a.Component),x=function(t){Object(l.a)(n,t);var e=Object(u.a)(n);function n(){var t;Object(c.a)(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(t=e.call.apply(e,[this].concat(o))).SIZE=50,t.chunk={},t.state={},t}return Object(r.a)(n,[{key:"backgroundSquares",value:function(){var t=this,e=[];return this.props.data.pixels.forEach((function(n){e.push(o.a.createElement(E,{key:n.x+"_"+n.y,pixel:n,chunkPosition:{x:t.props.data.x,y:t.props.data.y},playerPosition:t.props.playerPosition}))})),e}},{key:"render",value:function(){var t=this.props.x,e=this.props.y,n=Math.ceil(window.innerHeight/50),a=Math.ceil(window.innerWidth/50),s=-this.props.playerPosition.x+Math.floor(a/2),i=-this.props.playerPosition.y+Math.floor(n/2);return o.a.createElement("div",{className:"chunk",style:{position:"absolute",border:"solid thin black",width:"".concat(this.SIZE*this.chunk.size,"px"),height:"".concat(this.SIZE*this.chunk.size,"px"),backgroundColor:"pink",left:50*(t+s)+"px",top:50*(e+i)+"px"}},o.a.createElement("div",{className:"squares"},this.backgroundSquares()))}}]),n}(o.a.Component),w=function(t){Object(l.a)(n,t);var e=Object(u.a)(n);function n(){var t;Object(c.a)(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(t=e.call.apply(e,[this].concat(o))).CHUNKSIZE=10,t.state={playerPosition:{x:-99,y:-99},chunkData:{}},t}return Object(r.a)(n,[{key:"componentDidMount",value:function(t){this.updateChunks()}},{key:"requestChunk",value:function(t,e){var n=this;if(void 0===this.state.chunkData["".concat(t,"_").concat(e)]){var a=this.state;a.chunkData["".concat(t,"_").concat(e)]={pixels:[],objects:[]},this.setState(a);var o="".concat(k(),"://").concat(b(),"/chunks?x=").concat(t,"&y=").concat(e);fetch(o).then((function(t){return t.json()})).then((function(a){var o=n.state;o.chunkData["".concat(t,"_").concat(e)]=a,n.setState(o)}))}}},{key:"updateChunks",value:function(){var t=this,e=Math.ceil(window.innerHeight/50),n=Math.ceil(window.innerWidth/50),a=this.playerPosition(),o=Math.floor(a.x-n/2),s=Math.floor(a.y-e/2),i=Math.ceil(a.x+n/2),c=Math.ceil(a.y+e/2);o=o-o%this.CHUNKSIZE-this.CHUNKSIZE,s=s-s%this.CHUNKSIZE-this.CHUNKSIZE,i=i+i%this.CHUNKSIZE+this.CHUNKSIZE,c=c+c%this.CHUNKSIZE+this.CHUNKSIZE;var r=Math.ceil((i-o)/this.CHUNKSIZE),l=Math.ceil((c-s)/this.CHUNKSIZE),u=Object(j.a)(Array(r).keys()),h=Object(j.a)(Array(l).keys());u.forEach((function(e){h.forEach((function(n){void 0===t.state.chunkData["".concat(e,"_").concat(n)]&&t.requestChunk(o+e*t.CHUNKSIZE,s+n*t.CHUNKSIZE)}))}))}},{key:"playerPosition",value:function(){return this.props.app.playerPosition()}},{key:"isSolidAt",value:function(t){var e=Math.floor(t.x/this.CHUNKSIZE)*this.CHUNKSIZE,n=Math.floor(t.y/this.CHUNKSIZE)*this.CHUNKSIZE,a=this.state.chunkData["".concat(e,"_").concat(n)];if(void 0===a)return!1;var o=!1;return a.pixels.forEach((function(e){Math.ceil(t.x)===e.x&&Math.ceil(t.y)===e.y&&e.g>180&&(o=!0)})),o}},{key:"render",value:function(){var t=this,e=[];return Object.keys(this.state.chunkData).forEach((function(n){var a=t.state.chunkData[n],s=o.a.createElement(x,{x:a.x,y:a.y,key:n,playerPosition:t.playerPosition(),data:a,objectEventBus:t.props.objectEventBus});e.push(s)})),o.a.createElement("div",{id:"chunks"},e)}}]),n}(o.a.Component),S=function(t){Object(l.a)(n,t);var e=Object(u.a)(n);function n(t){var a;return Object(c.a)(this,n),(a=e.call(this,t)).state={object:{x:0,y:0}},a.state.object=t.object,a}return Object(r.a)(n,[{key:"isSolid",value:function(){return this.props.object.solid}}]),Object(r.a)(n,[{key:"componentDidMount",value:function(){var t=this;this.props.objectEventBus.on("object-update",(function(e){if(t.props.id===e.id){var n=t.state;n.object=e,t.setState(n)}}))}},{key:"render",value:function(){var t=this,e=this.state.object,n=this.props.size,a=e.x,s=e.y,i=Math.ceil(window.innerHeight/50),c=Math.ceil(window.innerWidth/50),r=-this.props.playerPosition.x+Math.floor(c/2),l=-this.props.playerPosition.y+Math.floor(i/2),u=[];return e.images.forEach((function(a){u.push(o.a.createElement("img",{style:{width:"".concat(n,"px"),height:"".concat(n,"px"),position:"absolute",left:"0px",top:"0px"},key:"".concat(e.id,"_img_").concat(u.length),src:"".concat(k(),"://").concat(b()).concat(a),alt:t.props.object.type}))})),o.a.createElement("div",{style:{position:"absolute",width:n+"px",height:n+"px",zIndex:this.props.zIndex,left:n*(a+r)+"px",top:n*(s+l)+"px"}},u)}}]),n}(o.a.Component),O=function(t){Object(l.a)(n,t);var e=Object(u.a)(n);function n(){var t;Object(c.a)(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(t=e.call.apply(e,[this].concat(o))).SIZE=50,t.state={objects:{}},t}return Object(r.a)(n,[{key:"componentDidMount",value:function(){var t=this;this.props.objectEventBus.on("object-update",(function(e){console.log("update:",e);var n=t.state;"remove"===e.action?delete n.objects[e.id]:n.objects[e.id]=e,t.setState(n)}))}},{key:"isSolidAt",value:function(t){var e=!1;return Object.values(this.state.objects).forEach((function(n){Math.ceil(t.x)===n.x&&Math.ceil(t.y)===n.y&&(e=e||n.solid,console.log(n))})),console.log(e),e}},{key:"render",value:function(){var t=this,e={x:0,y:0};function n(t,n,a){return o.a.createElement(S,{object:t,key:t.id,id:t.id,size:n,objectEventBus:a,playerPosition:e})}null!==this.props.player.current&&(e=this.props.player.current.state.playerPosition);var a=[];return Object.values(this.state.objects).forEach((function(e){"player"!==e.type&&a.push(n(e,t.SIZE,t.props.objectEventBus))})),Object.values(this.state.objects).forEach((function(e){"player"===e.type&&a.push(n(e,t.SIZE,t.props.objectEventBus))})),o.a.createElement("div",{className:"objects"},a)}}]),n}(o.a.Component),C=n(24).v4,I=function(t){Object(l.a)(n,t);var e=Object(u.a)(n);function n(){return Object(c.a)(this,n),e.apply(this,arguments)}return Object(r.a)(n,[{key:"render",value:function(){return o.a.createElement("div",{className:"chat_message",style:{color:"white"}},this.props.message.from.substr(1,6),": ",this.props.message.message)}}]),n}(o.a.Component),M=function(t){Object(l.a)(n,t);var e=Object(u.a)(n);function n(){var t;Object(c.a)(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(t=e.call.apply(e,[this].concat(o))).id=C(),t.ws=new WebSocket("".concat(g(),"://").concat(b(),"/chat")),t.state={messages:[],text:""},t}return Object(r.a)(n,[{key:"componentDidMount",value:function(){var t=this;this.ws.onopen=function(){t.ws.send('{"id":"'.concat(t.id,'", "message":"logged in"}'))},this.ws.onmessage=function(e){var n=JSON.parse(e.data),a=t.state;a.messages.push(n),t.setState(a)},this.ws.onclose=function(){console.log("disconnected")}}},{key:"sendMessage",value:function(t,e){t.preventDefault(),console.log(this.state.text),this.ws.send('{"id":"'.concat(this.id,'", "message":"').concat(this.state.text,'"}'));var n=this.state;n.text="",this.setState(n)}},{key:"textChange",value:function(t){var e=this.state;e.text=t.target.value,this.setState(e)}},{key:"render",value:function(){var t=[];return this.state.messages.forEach((function(e,n){t.push(o.a.createElement(I,{key:"msg_".concat(n),message:e}))})),o.a.createElement("div",{style:{width:"300px",height:"500px",backgroundColor:"rgba(20,20,20,0.8)",position:"absolute",top:"10px",left:"10px"}},o.a.createElement("div",{style:{color:"white"}},"you are ",this.id.substr(1,6)),o.a.createElement("div",null,t),o.a.createElement("form",{onSubmit:this.sendMessage.bind(this)},o.a.createElement("input",{type:"text",style:{bottom:"6px",left:"5px",width:"185px",position:"absolute"},onChange:this.textChange.bind(this),value:this.state.text})))}}]),n}(o.a.Component),P=function(t){Object(l.a)(a,t);var e=Object(u.a)(a);function a(t){var s;return Object(c.a)(this,a),(s=e.call(this,t)).state={accessToken:null,googleId:null},s.background=o.a.createRef(),s.objects=o.a.createRef(),s.player=o.a.createRef(),s.objectEventBus=n(23)(),s}return Object(r.a)(a,[{key:"playerPosition",value:function(){return null===this.player.current?{x:0,y:0}:this.player.current.state.playerPosition}},{key:"loginSuccess",value:function(t){var e=this.state;e.accessToken=t.accessToken,e.googleId=t.googleId,this.setState(e)}},{key:"renderLogin",value:function(){return o.a.createElement("div",{style:{margin:"auto",width:"200px",paddingTop:"200px"}},o.a.createElement(p.a,{clientId:"662193159992-4fv4hq3q25mkerlt0eqqr1ii670ogugr.apps.googleusercontent.com",onSuccess:this.loginSuccess.bind(this),isSignedIn:!0}))}},{key:"renderGame",value:function(){return o.a.createElement("div",null,o.a.createElement(m,{size:50,background:this.background,objects:this.objects,ref:this.player,app:this,objectEventBus:this.objectEventBus,accessToken:this.state.accessToken,googleId:this.state.googleId}),o.a.createElement(w,{size:50,ref:this.background,app:this}),o.a.createElement(O,{size:50,objectEventBus:this.objectEventBus,player:this.player,ref:this.objects}),o.a.createElement(M,null))}},{key:"render",value:function(){return null===this.state.accessToken?this.renderLogin():this.renderGame()}}]),a}(o.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(P,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))}},[[11,1,2]]]);
//# sourceMappingURL=main.76b3596c.chunk.js.map