{"version":3,"sources":["utils.js","components/player.js","components/background.js","components/objects.js","components/chat.js","web_socket.js","components/player_editor.js","App.js","serviceWorker.js","index.js"],"names":["hostname","window","location","href","split","ws_prefix","http_prefix","Player","state","id","undefined","playerPosition","x","y","debouncedMovePlayer","_","debounce","key","e","wait","movePlayer","leading","maxWait","a","email","firstName","lastName","s","this","ws","send","d","url","console","log","WebSocket","onopen","sendAccessToken","props","accessToken","googleId","onmessage","evt","message","JSON","parse","data","playerId","setState","objectEventBus","emit","nextPlayerPosition","type","background","current","updateChunks","as","app","onclose","setPage","sendPlayerMove","handleKeys","onKeyEvent","children","React","Component","Square","pixel","g","p","color","r","b","isSolid","style","width","height","left","chunkPosition","top","backgroundColor","position","Chunk","SIZE","chunk","pixels","forEach","push","squaresTall","Math","ceil","innerHeight","squaresWide","innerWidth","offsetX","floor","offsetY","className","border","size","backgroundSquares","Background","CHUNKSIZE","chunkData","objects","fetch","then","res","json","pp","minX","minY","maxX","maxY","chunksWide","chunksTall","xIndex","Array","keys","yIndex","requestChunk","solid","chunks","Object","GameObject","object","on","images","src","length","alt","zIndex","Objects","action","values","makeObject","o","player","uuidv4","require","v4","ChatMessage","from","substr","Chat","messages","text","msg","preventDefault","event","target","value","i","onSubmit","sendMessage","bind","bottom","onChange","textChange","sleep","ms","Promise","resolve","setTimeout","web_socket_connection","processMessage","waitForConn","callback","readyState","SlotTypes","1","2","3","4","5","6","7","8","BACKPACK","GROUND","PlayerEditor","sendBackpackRequest","textAlign","float","DndProvider","backend","HTML5Backend","DraggableItem","useDrag","item","allowed_slot","end","monitor","dropResult","getDropResult","name","unequipItem","dropItem","equipItem","collect","isDragging","drag","preview","DragPreviewImage","connect","dropped_image","ref","ItemSlot","useDrop","accept","slot","drop","isOver","canDrop","BackpackSlot","GroundSlot","Backpack","items","PlayerEditorEquip","equipped_slot","silhouette_style","equipped_image","transform","right","Ground","App","page","createRef","profileObj","givenName","familyName","margin","paddingTop","clientId","onSuccess","loginSuccess","isSignedIn","renderLogin","renderGame","renderInventory","Boolean","match","ReactDOM","render","StrictMode","document","getElementById","navigator","serviceWorker","ready","registration","unregister","catch","error"],"mappings":"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","file":"static/js/main.3fc5d904.chunk.js","sourcesContent":["function hostname() {\n    let hostname = window.location.href.split(\"/\")[2]\n    if(hostname===\"localhost:3000\"){\n        return \"localhost:2305\"\n    }\n    return hostname\n}\n\nfunction ws_prefix() {\n    if(hostname()===\"localhost:2305\"){\n        return \"ws\"\n    }\n    return \"wss\"\n}\n\nfunction http_prefix() {\n    if(hostname()===\"localhost:2305\"){\n        return \"http\"\n    }\n    return \"https\"\n}\n\nexport {hostname, ws_prefix, http_prefix}","import React from \"react\";\nimport _ from \"lodash\";\nimport KeyboardEventHandler from \"react-keyboard-event-handler\";\nimport {hostname, ws_prefix} from \"../utils\";\n\nclass Player extends React.Component {\n\n    state = {\n        id: undefined,\n        playerPosition: {x: 0, y: 0},\n    }\n\n    sendAccessToken(a,id, email,firstName, lastName){\n        let s = `{\"accessToken\":\"${a}\", \"googleId\":\"${id}\", \"email\":\"${email}\", \"firstName\":\"${firstName}\", \"lastName\":\"${lastName}\"}`\n        this.ws.send(s)\n    }\n\n    sendPlayerMove(d){\n        let s = `{\"direction\":\"${d}\"}`\n        this.ws.send(s)\n    }\n\n    componentDidMount() {\n        let url = `${ws_prefix()}://${hostname()}/objects`\n        console.log(url)\n        this.ws = new WebSocket(url)\n\n        this.ws.onopen = () => {\n            // on connecting, do nothing but log it to the console\n            console.log('connected to objects ws')\n            this.sendAccessToken(this.props.accessToken, this.props.googleId, this.props.email,this.props.firstName, this.props.lastName)\n            // this.sendPlayerCoordinates(this.state.playerPosition)\n        }\n\n        this.ws.onmessage = evt => {\n            // on receiving a message, add it to the list of messages\n            const message = JSON.parse(evt.data)\n\n            let playerId = message[\"playerId\"]\n            if(playerId !== undefined) {\n                let state = this.state\n                state.id = playerId\n                this.setState(state)\n\n            } else{\n                this.props.objectEventBus.emit(\"object-update\", null, message)\n                if(message[\"id\"] === this.state.id) {\n                    let state = this.state\n                    state.playerPosition.x = message[\"x\"]\n                    state.playerPosition.y = message[\"y\"]\n                    this.setState(state)\n                }\n\n            }\n\n\n            let state = this.state\n            let nextPlayerPosition = state.playerPosition\n            if(message.type===\"player\"){\n                state.playerPosition = nextPlayerPosition\n                state.nextPlayerPosition = nextPlayerPosition\n                this.setState(state)\n                this.props.background.current.updateChunks()\n\n                let as = this.props.app.state;\n                as.playerPosition = nextPlayerPosition\n                this.props.app.setState(as)\n            }\n\n        }\n\n        this.ws.onclose = () => {\n            console.log('disconnected')\n        }\n    }\n\n    movePlayer(key, e) {\n        if (key === \"e\") {\n            console.log(\"key pressed\", key)\n            this.props.app.setPage(\"inventory\")\n        } else {\n            if (key === \"w\") key = \"up\"\n            if (key === \"a\") key = \"left\"\n            if (key === \"s\") key = \"down\"\n            if (key === \"d\") key = \"right\"\n            this.props.background.current.updateChunks()\n            this.sendPlayerMove(key)\n        }\n    }\n\n    debouncedMovePlayer = _.debounce( (key, e, wait) => {\n        this.movePlayer(key, e)\n    }, 350, {leading:true, maxWait:350})\n\n    render(){\n        return <>\n            <KeyboardEventHandler\n                handleKeys={[\"left\", \"right\", \"up\", \"down\", \"w\", \"a\", \"s\", \"d\", \"e\"]}\n                onKeyEvent={(key, e) => {\n                    this.debouncedMovePlayer(key, e, 100)\n                }}\n            />\n            { this.props.children }\n        </>\n    }\n}\n\nexport default Player","import React from \"react\";\nimport {hostname, http_prefix} from \"../utils\";\n\nclass Square extends React.Component {\n\n    isSolid(){\n        return this.props.pixel.g > 180\n    }\n\n    render() {\n        let p = this.props.pixel\n        let color = `rgb(${p.r}, ${p.g}, ${p.b})`\n        if (this.isSolid()) {\n            color = `rgb(0, 80, 0)`\n        }\n        return <div style={{\n                width: \"50px\",\n                height: \"50px\",\n                left: `${50*(p.x-this.props.chunkPosition.x)}px`,\n                top: `${50*(p.y-this.props.chunkPosition.y)}px`,\n                backgroundColor: color,\n                position: \"absolute\"\n            }}>\n                {/*({p.x}, {p.y})*/}\n            </div>\n    }\n}\n\nclass Chunk extends React.Component {\n    SIZE = 50;\n    chunk = {}\n    state = {}\n\n    backgroundSquares() {\n        let pixels = []\n        // if(this.chunk.pixels === null || this.chunk.pixels === undefined) { return [] }\n        this.props.data.pixels.forEach(pixel => {\n\n            pixels.push(<Square\n                key={pixel.x+\"_\"+pixel.y}\n                pixel={pixel}\n                chunkPosition={{x:this.props.data.x, y:this.props.data.y}}\n                playerPosition={this.props.playerPosition}\n            />)\n        })\n        return pixels\n    }\n\n    render() {\n        let x = this.props.x\n        let y = this.props.y\n        let size = 50;\n        let squaresTall = Math.ceil(window.innerHeight/size);\n        let squaresWide = Math.ceil(window.innerWidth/size);\n        let offsetX = -this.props.playerPosition.x + Math.floor(squaresWide/2)\n        let offsetY = -this.props.playerPosition.y + Math.floor(squaresTall/2)\n\n        return <div className=\"chunk\" style={{\n            // zIndex: \"0\",\n            position: \"absolute\",\n            border:\"solid thin black\",\n            width: `${this.SIZE*this.chunk.size}px`,\n            height: `${this.SIZE*this.chunk.size}px`,\n            backgroundColor: \"pink\",\n            left: size*(x+offsetX)+\"px\",\n            top: size*(y+offsetY)+\"px\",\n\n        }}>\n            <div className=\"squares\">{this.backgroundSquares()}</div>\n        </div>\n    }\n}\n\nclass Background extends React.Component {\n\n    CHUNKSIZE = 10\n\n    state = {\n        playerPosition: {x:-99, y:-99},\n        chunkData: {},\n    }\n\n    componentDidMount(props) {\n        this.updateChunks()\n    }\n\n    requestChunk(x, y) {\n        if (this.state.chunkData[`${x}_${y}`] !== undefined ){\n            return\n        }\n\n        // so we don't request again\n        let state = this.state\n        state.chunkData[`${x}_${y}`] = {pixels:[], objects:[]}\n        this.setState(state)\n\n        let url = `${http_prefix()}://${hostname()}/chunks?x=${x}&y=${y}`\n        fetch(url)\n            .then(res => res.json())\n            .then(chunkData => {\n                let state = this.state\n                state.chunkData[`${x}_${y}`] = chunkData\n                this.setState(state)\n            });\n    }\n\n    updateChunks(){\n        let size = 50;\n        let squaresTall = Math.ceil(window.innerHeight/size);\n        let squaresWide = Math.ceil(window.innerWidth/size);\n\n        let pp = this.playerPosition()\n        let minX = Math.floor(pp.x - squaresWide/2)\n        let minY = Math.floor(pp.y - squaresTall/2)\n        let maxX = Math.ceil(pp.x + squaresWide/2)\n        let maxY = Math.ceil(pp.y + squaresTall/2)\n\n        minX = minX - minX%this.CHUNKSIZE - this.CHUNKSIZE\n        minY = minY - minY%this.CHUNKSIZE - this.CHUNKSIZE\n        maxX = maxX + maxX%this.CHUNKSIZE + this.CHUNKSIZE\n        maxY = maxY + maxY%this.CHUNKSIZE + this.CHUNKSIZE\n\n        let chunksWide = Math.ceil((maxX-minX)/this.CHUNKSIZE)\n        let chunksTall = Math.ceil((maxY-minY)/this.CHUNKSIZE)\n\n        let xIndex = [...Array(chunksWide).keys()]\n        let yIndex = [...Array(chunksTall).keys()]\n        xIndex.forEach(x => {\n            yIndex.forEach(y => {\n                if (this.state.chunkData[`${x}_${y}`] === undefined ){\n                    this.requestChunk(minX+x*this.CHUNKSIZE,minY+y*this.CHUNKSIZE)\n                }\n           })\n        })\n    }\n\n    playerPosition() {\n        return this.props.app.playerPosition()\n    }\n\n    isSolidAt(p){\n\n        let x = Math.floor(p.x/this.CHUNKSIZE)*this.CHUNKSIZE\n        let y = Math.floor(p.y/this.CHUNKSIZE)*this.CHUNKSIZE\n        let chunk = this.state.chunkData[`${x}_${y}`]\n        if(chunk === undefined) {\n            return false\n        }\n        let solid = false\n\n        chunk.pixels.forEach(pixel => {\n            if(Math.ceil(p.x) === pixel.x && Math.ceil(p.y) === pixel.y){\n                if(pixel.g > 180){\n                    solid = true\n                }\n            }\n        })\n\n        // chunk.objects.forEach(object => {\n        //     if(Math.ceil(p.x) === object.x && Math.ceil(p.y) === object.y){\n        //          if(object.solid){\n        //             solid = true\n        //         }\n        //     }\n        // })\n\n        return solid\n    }\n\n    render() {\n        let chunks = [];\n        let keys = Object.keys(this.state.chunkData)\n        keys.forEach(key => {\n            let chunkData = this.state.chunkData[key]\n            let chunk = <Chunk\n                x={chunkData.x}\n                y={chunkData.y}\n                key={key}\n                playerPosition={this.playerPosition()}\n                data={chunkData}\n                objectEventBus={this.props.objectEventBus}\n            />;\n            chunks.push(chunk)\n        })\n\n        return (<div id=\"chunks\">\n            {chunks}\n        </div>);\n    }\n}\n\nexport default Background","import React from \"react\";\nimport {hostname, http_prefix} from \"../utils\";\n\nclass GameObject extends React.Component {\n\n    state = {\n        object: {x:0, y:0}\n    }\n\n    isSolid(){\n        return this.props.object.solid\n    }\n\n    constructor(props) {\n        super(props);\n        this.state.object = props.object\n    }\n\n    componentDidMount(){\n        this.props.objectEventBus.on(\"object-update\", object => {\n            if(this.props.id === object.id){\n                let state = this.state\n                state.object = object\n                this.setState(state)\n            }\n        })\n    }\n\n    render() {\n        let p = this.state.object\n        let s = this.props.size\n        let x = p.x\n        let y = p.y\n        let size = 50;\n        let squaresTall = Math.ceil(window.innerHeight/size);\n        let squaresWide = Math.ceil(window.innerWidth/size);\n        let offsetX = -this.props.playerPosition.x + Math.floor(squaresWide/2)\n        let offsetY = -this.props.playerPosition.y + Math.floor(squaresTall/2)\n\n        let images = []\n        p.images.forEach(src => {\n            images.push(<img style={{\n                width: `${s}px`,\n                height: `${s}px`,\n                position: \"absolute\",\n                left: \"0px\",\n                top: \"0px\",\n            }}\n                 key={`${p.id}_img_${images.length}`}\n                 src={`${http_prefix()}://${hostname()}${src}`}\n                 alt={this.props.object.type}\n            />)\n\n        })\n        return <div style={{\n            position: \"absolute\",\n            width: s+\"px\",\n            height: s+\"px\",\n            zIndex: this.props.zIndex,\n            left:s*(x+offsetX)+\"px\",\n            top:s*(y+offsetY)+\"px\",\n        }}>\n            {images}\n        </div>\n    }\n}\n\nclass Objects extends React.Component {\n    SIZE = 50\n\n    state = {\n        objects: {}\n    }\n\n    componentDidMount(){\n        this.props.objectEventBus.on(\"object-update\", object => {\n            console.log(\"update:\", object)\n            let state = this.state\n            if (object.action === \"remove\") {\n                delete state.objects[object.id]\n            } else {\n                state.objects[object.id] = object\n            }\n            this.setState(state)\n        })\n    }\n\n    isSolidAt(p){\n        let solid = false\n        Object.values(this.state.objects).forEach(object => {\n            if(Math.ceil(p.x) === object.x && Math.ceil(p.y) === object.y){\n                 solid = solid || object.solid\n            }\n        })\n        console.log(solid)\n        return solid\n    }\n\n    render() {\n\n        let playerPosition = {x:0, y:0}\n        if(this.props.player.current !== null){\n            playerPosition = this.props.player.current.state.playerPosition\n        }\n\n        function makeObject(o, size, objectEventBus) {\n            return <GameObject\n                object={o}\n                key={o.id}\n                id={o.id}\n                size={size}\n                objectEventBus={objectEventBus}\n                playerPosition={playerPosition}\n            />\n        }\n\n        let objects = [];\n        Object.values(this.state.objects).forEach(o => {\n            if(o.type !== \"player\"){\n                objects.push(makeObject(o, this.SIZE, this.props.objectEventBus))\n            }\n        })\n        Object.values(this.state.objects).forEach(o => {\n            if(o.type === \"player\"){\n                objects.push(makeObject(o, this.SIZE, this.props.objectEventBus))\n            }\n        })\n        return <div className=\"objects\">\n            {objects}\n        </div>\n    }\n\n\n}\n\nexport default Objects","import React from \"react\";\nimport {hostname, ws_prefix} from \"../utils\";\n\nconst { v4: uuidv4 } = require('uuid');\n\nclass ChatMessage extends React.Component {\n\n    render(){\n        return <div className=\"chat_message\" style={{color:\"white\"}}>{this.props.message.from.substr(1, 6)}: {this.props.message.message}</div>\n    }\n}\n\nclass Chat extends React.Component {\n    id = uuidv4();\n    ws = new WebSocket(`${ws_prefix()}://${hostname()}/chat`)\n    state = {\n        messages: [],\n        text: \"\",\n    }\n\n    componentDidMount() {\n        this.ws.onopen = () => {\n            // on connecting, do nothing but log it to the console\n            this.ws.send(`{\"id\":\"${this.id}\", \"message\":\"logged in\"}`)\n        }\n\n        this.ws.onmessage = evt => {\n            // on receiving a message, add it to the list of messages\n            const message = JSON.parse(evt.data)\n            let state = this.state\n            state.messages.push(message)\n            this.setState(state)\n        }\n\n        this.ws.onclose = () => {\n            console.log('disconnected')\n        }\n    }\n\n    sendMessage(e, msg){\n        e.preventDefault();\n        console.log(this.state.text)\n        this.ws.send(`{\"id\":\"${this.id}\", \"message\":\"${this.state.text}\"}`)\n        let state = this.state\n        state.text = \"\"\n        this.setState(state)\n    }\n\n    textChange(event) {\n        let state = this.state\n        state.text = event.target.value\n        this.setState(state)\n    }\n\n    render(){\n        let messages = [];\n        this.state.messages.forEach((msg, i) => {\n            messages.push(<ChatMessage key={`msg_${i}`} message={msg} />)\n        })\n\n        return <div style={{\n            width:\"300px\",\n            height:\"500px\",\n            backgroundColor: \"rgba(20,20,20,0.8)\",\n            position: \"absolute\",\n            top: \"10px\",\n            left: \"10px\",\n        }} >\n            <div style={{color:\"white\"}}>you are {this.id.substr(1, 6)}</div>\n            <div>\n                {messages}\n            </div>\n            <form onSubmit={this.sendMessage.bind(this)}>\n                <input type=\"text\"\n                       style={{\n                           bottom: \"6px\",\n                           left: \"5px\",\n                           width: \"185px\",\n                           position: \"absolute\"\n                       }}\n                       onChange={this.textChange.bind(this)}\n                       value={this.state.text}\n                />\n            </form>\n        </div>\n    }\n}\n\nexport default Chat","import {hostname, ws_prefix} from \"./utils\";\n\nfunction sleep(ms) {\n    return new Promise(resolve => setTimeout(resolve, ms));\n}\n\nclass WebSocketConnection {\n\n    sendAccessToken(a,id, email,firstName, lastName){\n        this.waitForConn(\n            () => {\n                let s = `{\"accessToken\":\"${a}\", \"googleId\":\"${id}\", \"email\":\"${email}\", \"firstName\":\"${firstName}\", \"lastName\":\"${lastName}\"}`\n                this.ws.send(s)\n            })\n    }\n\n    sendBackpackRequest(){\n        this.waitForConn(\n            () => {\n                this.ws.send(`{\"backpack\":\"please\"}`)\n            }\n        )\n\n    }\n\n    sendPlayerMove(d){\n        this.waitForConn(\n            () => {\n                this.ws.send(`{\"direction\":\"${d}\"}`)\n            })\n    }\n\n    equipItem(id) {\n        this.waitForConn(\n            () => {\n                this.ws.send(`{\"equip_item\":${id}}`)\n            })\n    }\n\n    unequipItem(id) {\n        this.waitForConn(\n            () => {\n                this.ws.send(`{\"unequip_item\":${id}}`)\n            })\n    }\n\n    dropItem(id) {\n        this.waitForConn(\n            () => {\n                this.ws.send(`{\"drop_item\":${id}}`)\n            })\n    }\n\n    async waitForConn(callback){\n        while(this.ws.readyState !== 1){\n            await sleep(1);\n        }\n        callback()\n    }\n\n    processMessage(msg) {\n        console.log(\"received msg on generic ws:\", msg)\n\n        // item\n        if(msg[\"equipped_image\"] !== undefined){\n            this.objectEventBus.emit(\"item\", null, msg)\n        }\n\n    }\n\n    constructor() {\n        this.objectEventBus = require('js-event-bus')();\n\n        let url = `${ws_prefix()}://${hostname()}/objects`\n        console.log(url)\n        this.ws = new WebSocket(url)\n\n        this.ws.onopen = () => {\n            console.log('connected to generic ws')\n        }\n\n        this.ws.onmessage = evt => {\n            const message = JSON.parse(evt.data)\n            this.processMessage(message)\n        }\n\n        this.ws.onclose = () => {\n            console.log('disconnected generic ws')\n        }\n    }\n}\n\n\nlet web_socket_connection = new WebSocketConnection()\n\nexport default web_socket_connection","import React from \"react\";\nimport web_socket_connection from \"../web_socket\"\nimport { DndProvider,DragPreviewImage } from 'react-dnd'\nimport { HTML5Backend } from 'react-dnd-html5-backend'\nimport { useDrag } from 'react-dnd'\nimport { useDrop } from 'react-dnd'\nimport {hostname, http_prefix} from \"../utils\";\nimport KeyboardEventHandler from \"react-keyboard-event-handler\";\n\nconst SlotTypes = {\n    1: \"s1\",\n    2: \"s2\",\n    3: \"s3\",\n    4: \"s4\",\n    5: \"s5\",\n    6: \"s6\",\n    7: \"s7\",\n    8: \"s8\",\n    BACKPACK: \"backpack\",\n    GROUND: \"ground\",\n}\n\nclass PlayerEditor extends React.Component {\n\n    constructor(props) {\n        super(props);\n        web_socket_connection.sendBackpackRequest()\n    }\n\n    render() {\n        return <>\n            <div style={{textAlign:\"center\"}}>\n                <div style={{float:\"left\", width:\"300px\"}}>Equipped</div>\n                <div style={{float:\"left\", width:\"300px\"}}>Backpack</div>\n                <div style={{float:\"left\", width:\"300px\"}}>Ground</div>\n            </div>\n            <div  style={{top:\"20px\", position: \"absolute\"}} >\n                <DndProvider backend={HTML5Backend}>\n                    <PlayerEditorEquip />\n                    <Backpack />\n                    <Ground />\n                </DndProvider>\n            </div>\n            <KeyboardEventHandler\n                handleKeys={[\"esc\", \"e\"]}\n                onKeyEvent={(key, e) => {\n                    this.props.app.setPage(\"game\")\n                }}\n            />\n        </>\n    }\n}\n\n\nfunction DraggableItem(props) {\n    const [{ isDragging }, drag, preview] = useDrag({\n        item: { type: SlotTypes[props.item.allowed_slot] },\n        end: (item, monitor) => {\n            const dropResult = monitor.getDropResult()\n            if (item && dropResult) {\n                if(dropResult.name === \"backpack\") {\n                    web_socket_connection.unequipItem(props.item.id)\n                } else if(dropResult.name === \"ground\"){\n                    web_socket_connection.dropItem(props.item.id)\n                } else {\n                    web_socket_connection.equipItem(props.item.id)\n                }\n            }\n        },\n        collect: (monitor) => ({\n            isDragging: monitor.isDragging(),\n        }),\n    })\n    return <>\n        <DragPreviewImage connect={preview} src={props.item.dropped_image} />\n        <div ref={drag} style={{...props.style}}>\n            <img src={`${http_prefix()}://${hostname()}/${props.item.dropped_image}`} alt={props.item.name} />\n        </div>\n    </>\n}\n\n\nfunction ItemSlot(props) {\n    const [{ canDrop, isOver }, drop] = useDrop({\n        accept: SlotTypes[props.slot],\n        drop: () => ({ name: `slot ${props.slot}` }),\n        collect: (monitor) => ({\n            isOver: monitor.isOver(),\n            canDrop: monitor.canDrop(),\n        }),\n    })\n    const isActive = canDrop && isOver\n    let backgroundColor = '#222'\n    if (isActive) {\n        backgroundColor = 'darkgreen'\n    } else if (canDrop) {\n        backgroundColor = 'darkkhaki'\n    }\n\n    let item = null\n    if(props.item !== undefined) {\n        item = <DraggableItem item={props.item} style={{...props.style, top:\"10px\", left:\"10px\"}}/>\n    }\n\n    return <>\n        <div ref={drop} style={{...props.style, backgroundColor }}>\n            <img style={{\n                width:\"50px\",\n                height: \"50px\",\n            }}\n                 src={`${http_prefix()}://${hostname()}/images/gui/tab_unselected.png`}\n                 alt={`slot ${props.slot}`}\n            />\n        </div>\n        {item}\n    </>\n}\n\n\nfunction BackpackSlot(props) {\n    const [{ canDrop, isOver }, drop] = useDrop({\n        accept: Object.values(SlotTypes),\n        drop: () => ({ name: `backpack` }),\n        collect: (monitor) => ({\n            isOver: monitor.isOver(),\n            canDrop: monitor.canDrop(),\n        }),\n    })\n    const isActive = canDrop && isOver\n    let backgroundColor = '#222'\n    if (isActive) {\n        backgroundColor = 'darkgreen'\n    } else if (canDrop) {\n        backgroundColor = 'darkkhaki'\n    }\n\n    let item = null\n\n    return <>\n        <div ref={drop} style={{width:\"100%\", height:\"100%\", border:\"solid thin black\", backgroundColor }}>\n        </div>\n        {item}\n    </>\n}\n\nfunction GroundSlot(props) {\n    const [{ canDrop, isOver }, drop] = useDrop({\n        accept: Object.values(SlotTypes),\n        drop: () => ({ name: `ground` }),\n        collect: (monitor) => ({\n            isOver: monitor.isOver(),\n            canDrop: monitor.canDrop(),\n        }),\n    })\n    const isActive = canDrop && isOver\n    let backgroundColor = '#222'\n    if (isActive) {\n        backgroundColor = 'darkgreen'\n    } else if (canDrop) {\n        backgroundColor = 'darkkhaki'\n    }\n\n    let item = null\n\n    return <>\n        <div ref={drop} style={{width:\"100%\", height:\"100%\", border:\"solid thin black\", backgroundColor }}>\n        </div>\n        {item}\n    </>\n}\n\nclass Backpack extends React.Component {\n\n    state = {\n        items: {}\n    }\n\n    componentDidMount() {\n        web_socket_connection.objectEventBus.on(\"item\", item => {\n            let state = this.state\n            if(item[\"is_carried\"] && !item[\"is_equipped\"]) {\n                state.items[item.id] = item\n            } else {\n                delete state.items[item.id]\n            }\n            this.setState(state)\n        })\n    }\n\n    render() {\n        let items = []\n        Object.values(this.state.items).forEach( item => {\n            items.push(<DraggableItem item={item} key={item.id}/>)\n        })\n        return <div style={{left:\"300px\", width: \"300px\", height: \"290px\", position: \"absolute\", border: \"solid thin black\"}}>\n            <BackpackSlot />\n            <div style={{position:\"absolute\", top:0, left:0}}>\n                {items}\n            </div>\n        </div>\n    }\n}\n\nclass PlayerEditorEquip extends React.Component {\n\n    state = {\n        items: {}\n    }\n\n    componentDidMount() {\n        web_socket_connection.objectEventBus.on(\"item\", item => {\n            let state = this.state\n            if(item[\"is_carried\"] && item[\"is_equipped\"]) {\n                state.items[item.equipped_slot] = item\n            } else {\n                delete state.items[item.allowed_slot]\n            }\n            this.setState(state)\n        })\n    }\n\n    render() {\n        let silhouette_style = {\n            position: \"absolute\",\n            width: \"200px\",\n            height: \"200px\",\n            left:\"50px\",\n            top: \"40px\"\n        }\n        let items = []\n        Object.values(this.state.items).forEach(item => {\n            items.push(<img style={silhouette_style}\n                 src={`${http_prefix()}://${hostname()}/${item.equipped_image}`}\n                 alt=\"silhouette\"\n                 key={item.id}\n            />)\n        })\n        return <div style={{width:\"300px\", height:\"290px\", position:\"absolute\", border: \"solid thin black\"}}>\n            <img style={silhouette_style}\n                 src={`${http_prefix()}://${hostname()}/images/player/base/human_m.png`}\n                 alt=\"silhouette\"\n            />\n            {items}\n\n            <ItemSlot style={{position: \"absolute\", left: \"0px\"}} slot={1} item={this.state.items[1]}/>\n            <ItemSlot style={{position: \"absolute\", transform: \"scaleX(-1)\", right: \"0px\"}} slot={2} item={this.state.items[2]}/>\n\n            <div style={{position: \"absolute\", top:\"80px\", width:\"100%\"}}>\n                <ItemSlot style={{position: \"absolute\", left: \"0px\"}} slot={3} item={this.state.items[3]}/>\n                <ItemSlot style={{position: \"absolute\", transform: \"scaleX(-1)\", right: \"0px\"}} slot={4} item={this.state.items[4]}/>\n            </div>\n\n            <div style={{position: \"absolute\", top:\"160px\", width:\"100%\"}}>\n                <ItemSlot style={{position: \"absolute\", left: \"0px\"}} slot={5}/>\n                <ItemSlot style={{position: \"absolute\", transform: \"scaleX(-1)\", right: \"0px\"}} slot={6}/>\n            </div>\n\n            <div style={{position: \"absolute\", top:\"240px\", width:\"100%\"}}>\n                <ItemSlot style={{position: \"absolute\", left: \"0px\"}} slot={7}/>\n                <ItemSlot style={{position: \"absolute\", transform: \"scaleX(-1)\", right: \"0px\"}} slot={8}/>\n            </div>\n\n        </div>\n    }\n}\n\nclass Ground extends React.Component {\n\n    state = {\n        items: {}\n    }\n\n    componentDidMount() {\n        web_socket_connection.objectEventBus.on(\"item\", item => {\n            let state = this.state\n            if(!item[\"is_carried\"]) {\n                state.items[item.equipped_slot] = item\n            } else {\n                delete state.items[item.allowed_slot]\n                delete state.items[item.equipped_slot]\n                delete state.items[-1]\n            }\n            this.setState(state)\n        })\n    }\n\n    render() {\n        let items = []\n        Object.values(this.state.items).forEach( item => {\n            items.push(<DraggableItem item={item} key={item.id}/>)\n        })\n        return <div style={{left:\"600px\", width: \"300px\", height: \"290px\", position: \"absolute\", border: \"solid thin black\"}}>\n            <GroundSlot />\n            <div style={{position:\"absolute\", top:0, left:0}}>\n                {items}\n            </div>\n        </div>\n    }\n}\n\nexport default PlayerEditor","import React from 'react';\nimport GoogleLogin from 'react-google-login';\nimport './App.css';\nimport Player from \"./components/player\";\nimport Background from \"./components/background\";\nimport Objects from \"./components/objects\";\nimport Chat from \"./components/chat\";\nimport PlayerEditor from \"./components/player_editor\";\nimport web_socket_connection from \"./web_socket\"\n\nclass App extends React.Component {\n\n    state = {\n        accessToken: null,\n        googleId: null,\n        email: \"\",\n        firstName: \"\",\n        lastName: \"\",\n        page: \"game\",\n    }\n\n    constructor(props) {\n        super(props);\n        this.background = React.createRef();\n        this.objects = React.createRef();\n        this.player = React.createRef();\n        this.objectEventBus = require('js-event-bus')();\n    }\n\n    playerPosition() {\n        if(this.player.current===null){\n            return {x:0, y:0}\n        }\n        return this.player.current.state.playerPosition\n    }\n\n    loginSuccess(data){\n        let state = this.state\n        state.accessToken = data.accessToken\n        state.googleId = data.googleId\n        state.firstName = data.profileObj.givenName\n        state.lastName = data.profileObj.familyName\n        state.email = data.profileObj.email\n        web_socket_connection.sendAccessToken(state.accessToken, state.googleId, state.email, state.firstName, state.lastName)\n        this.setState(state)\n    }\n\n    renderLogin() {\n        return <div style={{margin:\"auto\", width:\"200px\", paddingTop:\"200px\"}}>\n            <GoogleLogin\n                clientId=\"662193159992-4fv4hq3q25mkerlt0eqqr1ii670ogugr.apps.googleusercontent.com\"\n                onSuccess={this.loginSuccess.bind(this)}\n                isSignedIn={true}\n            />\n        </div>\n    }\n\n    setPage(name){\n        let state = this.state\n        state.page = name\n        console.log(state)\n        this.setState(state)\n    }\n\n    renderGame() {\n        let size = 50;\n        return <>\n            <Player\n                size={size}\n                background={this.background}\n                objects={this.objects}\n                ref={this.player}\n                app={this}\n                objectEventBus={this.objectEventBus}\n                accessToken={this.state.accessToken}\n                googleId={this.state.googleId}\n                email={this.state.email}\n                firstName={this.state.firstName}\n                lastName={this.state.lastName}\n            />\n            <Background\n                size={size}\n                ref={this.background}\n                app={this}\n            />\n            <Objects\n                size={size}\n                objectEventBus={this.objectEventBus}\n                player={this.player}\n                ref={this.objects}\n            />\n            <Chat/>\n        </>;\n    }\n\n    renderInventory(){\n        return <PlayerEditor\n            app={this}\n            player={this.player}\n            accessToken={this.state.accessToken}\n            googleId={this.state.googleId}\n            email={this.state.email}\n            firstName={this.state.firstName}\n            lastName={this.state.lastName}\n        />\n    }\n\n    render(){\n        if(this.state.accessToken === null)\n            return this.renderLogin()\n        if(this.state.page===\"game\")\n            return this.renderGame()\n        if(this.state.page===\"inventory\")\n            return this.renderInventory()\n        return null\n    }\n\n\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}