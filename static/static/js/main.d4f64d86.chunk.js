(this.webpackJsonpgame=this.webpackJsonpgame||[]).push([[0],{10:function(t,e,n){t.exports=n(24)},15:function(t,e,n){},16:function(t,e,n){},24:function(t,e,n){"use strict";n.r(e);var a=n(0),o=n.n(a),s=n(7),i=n.n(s),r=(n(15),n(2)),c=n(1),l=n(4),u=n(3),h=(n(16),o.a.Component,n(8)),p=n.n(h),d=n(9),y=n.n(d);var v=function(t){Object(l.a)(n,t);var e=Object(u.a)(n);function n(){var t;Object(r.a)(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(t=e.call.apply(e,[this].concat(o))).state={playerPosition:{x:0,y:0},nextPlayerPosition:{x:0,y:0}},t.ws=new WebSocket("ws://localhost:2303/objects"),t.debouncedMovePlayer=p.a.debounce((function(e,n,a){t.movePlayer(e,n)}),350,{leading:!0,maxWait:350}),t}return Object(c.a)(n,[{key:"sendPlayerCoordinates",value:function(){var t='{"x":'.concat(this.state.playerPosition.x,', "y":').concat(this.state.playerPosition.y,"}");console.log(t),this.ws.send(t)}},{key:"componentDidMount",value:function(){var t=this;this.ws.onopen=function(){console.log("connected to objects ws"),t.sendPlayerCoordinates()},this.ws.onmessage=function(e){var n=JSON.parse(e.data);t.props.objectEventBus.emit("object-update",null,n)},this.ws.onclose=function(){console.log("disconnected")}}},{key:"movePlayer",value:function(t,e){var n={x:this.state.playerPosition.x,y:this.state.playerPosition.y};function a(t,e,n){return["left","a"].includes(e)&&(t.x-=n),"right"!==e&&"d"!==e||(t.x+=n),"up"!==e&&"w"!==e||(t.y-=n),"down"!==e&&"s"!==e||(t.y+=n),t}["left","a","up","w"].includes(t)&&(n=a(n,t,1)),n=a(n,t,.5);var o=this.props.background.current.isSolidAt(n);o=o||this.props.objects.current.isSolidAt(n),n=a(n,t,.5),["left","a","up","w"].includes(t)&&(n=a(n,t,-1));var s=Math.round(n.x/1),i=Math.round(n.y/1);if(n.x=1*s,n.y=1*i,!o){var r=this.state;r.playerPosition=n,r.nextPlayerPosition=n,this.setState(r);var c=this.props.app.state;c.playerPosition=n,this.props.app.setState(c),this.sendPlayerCoordinates(),this.props.background.current.updateChunks()}}},{key:"render",value:function(){var t=this;return o.a.createElement(o.a.Fragment,null,o.a.createElement(y.a,{handleKeys:["left","right","up","down","w","a","s","d"],onKeyEvent:function(e,n){t.debouncedMovePlayer(e,n,100)}}),this.props.children)}}]),n}(o.a.Component),f=n(5),b=function(t){Object(l.a)(n,t);var e=Object(u.a)(n);function n(){return Object(r.a)(this,n),e.apply(this,arguments)}return Object(c.a)(n,[{key:"isSolid",value:function(){return this.props.pixel.g>180}},{key:"render",value:function(){var t=this.props.pixel,e="rgb(".concat(t.r,", ").concat(t.g,", ").concat(t.b,")");return this.isSolid()&&(e="rgb(0, 80, 0)"),o.a.createElement("div",{style:{width:"50px",height:"50px",left:"".concat(50*(t.x-this.props.chunkPosition.x),"px"),top:"".concat(50*(t.y-this.props.chunkPosition.y),"px"),backgroundColor:e,position:"absolute"}})}}]),n}(o.a.Component),j=function(t){Object(l.a)(n,t);var e=Object(u.a)(n);function n(){var t;Object(r.a)(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(t=e.call.apply(e,[this].concat(o))).SIZE=50,t.chunk={},t.state={},t}return Object(c.a)(n,[{key:"backgroundSquares",value:function(){var t=this,e=[];return this.props.data.pixels.forEach((function(n){e.push(o.a.createElement(b,{key:n.x+"_"+n.y,pixel:n,chunkPosition:{x:t.props.data.x,y:t.props.data.y},playerPosition:t.props.playerPosition}))})),e}},{key:"render",value:function(){var t=this.props.x,e=this.props.y,n=Math.ceil(window.innerHeight/50),a=Math.ceil(window.innerWidth/50),s=-this.props.playerPosition.x+Math.floor(a/2),i=-this.props.playerPosition.y+Math.floor(n/2);return o.a.createElement("div",{className:"chunk",style:{position:"absolute",border:"solid thin black",width:"".concat(this.SIZE*this.chunk.size,"px"),height:"".concat(this.SIZE*this.chunk.size,"px"),backgroundColor:"pink",left:50*(t+s)+"px",top:50*(e+i)+"px"}},o.a.createElement("div",{className:"squares"},this.backgroundSquares()))}}]),n}(o.a.Component),m=function(t){Object(l.a)(n,t);var e=Object(u.a)(n);function n(){var t;Object(r.a)(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(t=e.call.apply(e,[this].concat(o))).CHUNKSIZE=10,t.state={playerPosition:{x:-99,y:-99},chunkData:{}},t}return Object(c.a)(n,[{key:"componentDidMount",value:function(t){this.updateChunks()}},{key:"requestChunk",value:function(t,e){var n=this;if(void 0===this.state.chunkData["".concat(t,"_").concat(e)]){var a=this.state;a.chunkData["".concat(t,"_").concat(e)]={pixels:[],objects:[]},this.setState(a);var o="http://localhost:2303/chunks?x=".concat(t,"&y=").concat(e);fetch(o).then((function(t){return t.json()})).then((function(a){var o=n.state;o.chunkData["".concat(t,"_").concat(e)]=a,n.setState(o)}))}}},{key:"updateChunks",value:function(){var t=this,e=Math.ceil(window.innerHeight/50),n=Math.ceil(window.innerWidth/50),a=this.playerPosition(),o=Math.floor(a.x-n/2),s=Math.floor(a.y-e/2),i=Math.ceil(a.x+n/2),r=Math.ceil(a.y+e/2);o=o-o%this.CHUNKSIZE-this.CHUNKSIZE,s=s-s%this.CHUNKSIZE-this.CHUNKSIZE,i=i+i%this.CHUNKSIZE+this.CHUNKSIZE,r=r+r%this.CHUNKSIZE+this.CHUNKSIZE;var c=Math.ceil((i-o)/this.CHUNKSIZE),l=Math.ceil((r-s)/this.CHUNKSIZE),u=Object(f.a)(Array(c).keys()),h=Object(f.a)(Array(l).keys());u.forEach((function(e){h.forEach((function(n){void 0===t.state.chunkData["".concat(e,"_").concat(n)]&&t.requestChunk(o+e*t.CHUNKSIZE,s+n*t.CHUNKSIZE)}))}))}},{key:"playerPosition",value:function(){return this.props.app.playerPosition()}},{key:"isSolidAt",value:function(t){var e=Math.floor(t.x/this.CHUNKSIZE)*this.CHUNKSIZE,n=Math.floor(t.y/this.CHUNKSIZE)*this.CHUNKSIZE,a=this.state.chunkData["".concat(e,"_").concat(n)];if(void 0===a)return!1;var o=!1;return a.pixels.forEach((function(e){Math.ceil(t.x)===e.x&&Math.ceil(t.y)===e.y&&e.g>180&&(o=!0)})),o}},{key:"render",value:function(){var t=this,e=[];return Object.keys(this.state.chunkData).forEach((function(n){var a=t.state.chunkData[n],s=o.a.createElement(j,{x:a.x,y:a.y,key:n,playerPosition:t.playerPosition(),data:a,objectEventBus:t.props.objectEventBus});e.push(s)})),o.a.createElement("div",{id:"chunks"},e)}}]),n}(o.a.Component),k=function(t){Object(l.a)(n,t);var e=Object(u.a)(n);function n(t){var a;return Object(r.a)(this,n),(a=e.call(this,t)).state={object:{x:0,y:0}},a.state.object=t.object,a}return Object(c.a)(n,[{key:"isSolid",value:function(){return this.props.object.solid}}]),Object(c.a)(n,[{key:"componentDidMount",value:function(){var t=this;this.props.objectEventBus.on("object-update",(function(e){if(t.props.id===e.id){var n=t.state;n.object=e,t.setState(n)}}))}},{key:"render",value:function(){var t=this.state.object,e=this.props.size,n=t.x,a=t.y,s=Math.ceil(window.innerHeight/50),i=Math.ceil(window.innerWidth/50),r=-this.props.playerPosition.x+Math.floor(i/2),c=-this.props.playerPosition.y+Math.floor(s/2);return o.a.createElement("div",{style:{position:"absolute",width:e+"px",height:e+"px",zIndex:this.props.zIndex,left:e*(n+r)+"px",top:e*(a+c)+"px"}},o.a.createElement("img",{style:{width:"".concat(e,"px"),height:"".concat(e,"px")},src:this.props.object.image,alt:this.props.object.type}))}}]),n}(o.a.Component),x=function(t){Object(l.a)(n,t);var e=Object(u.a)(n);function n(){var t;Object(r.a)(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(t=e.call.apply(e,[this].concat(o))).SIZE=50,t.state={objects:{}},t}return Object(c.a)(n,[{key:"componentDidMount",value:function(){var t=this;this.props.objectEventBus.on("object-update",(function(e){console.log(e);var n=t.state;"remove"===e.action?delete n.objects[e.id]:n.objects[e.id]=e,t.setState(n)}))}},{key:"isSolidAt",value:function(t){var e=!1;return Object.values(this.state.objects).forEach((function(n){Math.ceil(t.x)===n.x&&Math.ceil(t.y)===n.y&&n.solid&&(e=!0)})),e}},{key:"render",value:function(){var t=this,e={x:0,y:0};null!==this.props.player.current&&(e=this.props.player.current.state.playerPosition);var n=[];return Object.values(this.state.objects).forEach((function(a){n.push(o.a.createElement(k,{object:a,key:a.id,id:a.id,size:t.SIZE,objectEventBus:t.props.objectEventBus,playerPosition:e}))})),o.a.createElement("div",{className:"objects"},n)}}]),n}(o.a.Component),g=n(23).v4,E=function(t){Object(l.a)(n,t);var e=Object(u.a)(n);function n(){return Object(r.a)(this,n),e.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){return o.a.createElement("div",{className:"chat_message",style:{color:"white"}},this.props.message.from.substr(1,6),": ",this.props.message.message)}}]),n}(o.a.Component),w=function(t){Object(l.a)(n,t);var e=Object(u.a)(n);function n(){var t;Object(r.a)(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(t=e.call.apply(e,[this].concat(o))).id=g(),t.ws=new WebSocket("ws://localhost:2303/chat"),t.state={messages:[],text:""},t}return Object(c.a)(n,[{key:"componentDidMount",value:function(){var t=this;this.ws.onopen=function(){t.ws.send('{"id":"'.concat(t.id,'", "message":"logged in"}'))},this.ws.onmessage=function(e){var n=JSON.parse(e.data),a=t.state;a.messages.push(n),t.setState(a)},this.ws.onclose=function(){console.log("disconnected")}}},{key:"sendMessage",value:function(t,e){t.preventDefault(),console.log(this.state.text),this.ws.send('{"id":"'.concat(this.id,'", "message":"').concat(this.state.text,'"}'));var n=this.state;n.text="",this.setState(n)}},{key:"textChange",value:function(t){var e=this.state;e.text=t.target.value,this.setState(e)}},{key:"render",value:function(){var t=[];return this.state.messages.forEach((function(e,n){t.push(o.a.createElement(E,{key:"msg_".concat(n),message:e}))})),o.a.createElement("div",{style:{width:"300px",height:"500px",backgroundColor:"rgba(20,20,20,0.8)",position:"absolute",top:"10px",left:"10px"}},o.a.createElement("div",{style:{color:"white"}},this.id.substr(1,6)),o.a.createElement("div",null,t),o.a.createElement("form",{onSubmit:this.sendMessage.bind(this)},o.a.createElement("input",{type:"text",style:{bottom:"6px",left:"5px",width:"185px",position:"absolute"},onChange:this.textChange.bind(this),value:this.state.text})))}}]),n}(o.a.Component),S=function(t){Object(l.a)(a,t);var e=Object(u.a)(a);function a(t){var s;return Object(r.a)(this,a),(s=e.call(this,t)).state={},s.background=o.a.createRef(),s.objects=o.a.createRef(),s.player=o.a.createRef(),s.objectEventBus=n(22)(),s}return Object(c.a)(a,[{key:"playerPosition",value:function(){return null===this.player.current?{x:0,y:0}:this.player.current.state.playerPosition}},{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement(v,{size:50,background:this.background,objects:this.objects,ref:this.player,app:this,objectEventBus:this.objectEventBus}),o.a.createElement(m,{size:50,ref:this.background,app:this}),o.a.createElement(x,{size:50,objectEventBus:this.objectEventBus,player:this.player,ref:this.objects}),o.a.createElement(w,null))}}]),a}(o.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(S,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))}},[[10,1,2]]]);
//# sourceMappingURL=main.d4f64d86.chunk.js.map