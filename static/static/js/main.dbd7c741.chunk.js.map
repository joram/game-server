{"version":3,"sources":["utils.js","components/player.js","components/background.js","components/objects.js","components/chat.js","App.js","serviceWorker.js","index.js"],"names":["hostname","window","location","href","split","ws_prefix","http_prefix","Player","state","playerPosition","x","y","nextPlayerPosition","debouncedMovePlayer","_","debounce","key","e","wait","movePlayer","leading","maxWait","s","this","ws","send","url","console","log","WebSocket","onopen","sendPlayerCoordinates","onmessage","evt","message","JSON","parse","data","props","objectEventBus","emit","onclose","move","position","offset","includes","isSolid","background","current","isSolidAt","objects","x_units","Math","round","y_units","setState","as","app","updateChunks","handleKeys","onKeyEvent","children","React","Component","Square","pixel","g","p","color","r","b","style","width","height","left","chunkPosition","top","backgroundColor","Chunk","SIZE","chunk","pixels","forEach","push","squaresTall","ceil","innerHeight","squaresWide","innerWidth","offsetX","floor","offsetY","className","border","size","backgroundSquares","Background","CHUNKSIZE","chunkData","undefined","fetch","then","res","json","pp","minX","minY","maxX","maxY","chunksWide","chunksTall","xIndex","Array","keys","yIndex","requestChunk","solid","chunks","Object","id","GameObject","object","on","images","src","length","alt","type","zIndex","Objects","action","values","player","o","uuidv4","require","v4","ChatMessage","from","substr","Chat","messages","text","msg","preventDefault","event","target","value","i","onSubmit","sendMessage","bind","bottom","onChange","textChange","App","createRef","ref","Boolean","match","ReactDOM","render","StrictMode","document","getElementById","navigator","serviceWorker","ready","registration","unregister","catch","error"],"mappings":"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","file":"static/js/main.dbd7c741.chunk.js","sourcesContent":["function hostname() {\n    let hostname = window.location.href.split(\"/\")[2]\n    if(hostname===\"localhost:3000\"){\n        return \"localhost:2305\"\n    }\n    return hostname\n}\n\nfunction ws_prefix() {\n    if(hostname()===\"localhost:2305\"){\n        return \"ws\"\n    }\n    return \"wss\"\n}\n\nfunction http_prefix() {\n    if(hostname()===\"localhost:2305\"){\n        return \"http\"\n    }\n    return \"https\"\n}\n\nexport {hostname, ws_prefix, http_prefix}","import React from \"react\";\nimport _ from \"lodash\";\nimport KeyboardEventHandler from \"react-keyboard-event-handler\";\nimport {hostname, ws_prefix} from \"../utils\";\n\nclass Player extends React.Component {\n\n    state = {\n        playerPosition: {x: 0, y: 0},\n        nextPlayerPosition: {x: 0, y: 0}\n    }\n\n\n    sendPlayerCoordinates(){\n        let s = `{\"x\":${this.state.playerPosition.x}, \"y\":${this.state.playerPosition.y}}`\n        this.ws.send(s)\n    }\n\n    componentDidMount() {\n        let url = `${ws_prefix()}://${hostname()}/objects`\n        console.log(url)\n        this.ws = new WebSocket(url)\n\n        this.ws.onopen = () => {\n            // on connecting, do nothing but log it to the console\n            console.log('connected to objects ws')\n            this.sendPlayerCoordinates()\n        }\n\n        this.ws.onmessage = evt => {\n            // on receiving a message, add it to the list of messages\n            const message = JSON.parse(evt.data)\n            this.props.objectEventBus.emit(\"object-update\", null, message)\n        }\n\n        this.ws.onclose = () => {\n            console.log('disconnected')\n        }\n    }\n\n    movePlayer(key, e) {\n        let offset = 1\n        let nextPlayerPosition = {x: this.state.playerPosition.x, y: this.state.playerPosition.y}\n\n        function move(position, key, offset) {\n            if ([\"left\",\"a\"].includes(key)) {\n                position.x -= offset\n            }\n            if (key === \"right\" || key === \"d\") {\n                position.x += offset\n            }\n            if (key === \"up\" || key === \"w\") {\n                position.y -= offset\n            }\n            if (key === \"down\" || key === \"s\") {\n                position.y += offset\n            }\n\n            return position\n        }\n\n        if([\"left\", \"a\", \"up\", \"w\"].includes(key)) {\n            nextPlayerPosition = move(nextPlayerPosition, key, 1)\n        }\n        nextPlayerPosition = move(nextPlayerPosition, key, offset/2)\n        let isSolid = this.props.background.current.isSolidAt(nextPlayerPosition)\n        isSolid = isSolid || this.props.objects.current.isSolidAt(nextPlayerPosition)\n\n        nextPlayerPosition = move(nextPlayerPosition, key, offset/2)\n        if([\"left\", \"a\", \"up\", \"w\"].includes(key)) {\n            nextPlayerPosition = move(nextPlayerPosition, key, -1)\n        }\n\n        let x_units = Math.round(nextPlayerPosition.x/offset)\n        let y_units = Math.round(nextPlayerPosition.y/offset)\n        nextPlayerPosition.x = x_units*offset\n        nextPlayerPosition.y = y_units*offset\n\n        if(!isSolid){\n            let state = this.state\n            state.playerPosition = nextPlayerPosition\n            state.nextPlayerPosition = nextPlayerPosition\n            this.setState(state)\n\n            // let ss = this.props.squares.current.state;\n            // ss.playerPosition = nextPlayerPosition\n            // this.props.squares.current.setState(ss)\n\n            let as = this.props.app.state;\n            as.playerPosition = nextPlayerPosition\n            this.props.app.setState(as)\n\n            this.sendPlayerCoordinates()\n            this.props.background.current.updateChunks()\n        }\n    }\n\n    debouncedMovePlayer = _.debounce( (key, e, wait) => {\n        this.movePlayer(key, e)\n    }, 350, {leading:true, maxWait:350})\n\n    render(){\n        return <>\n            {/*<Circle*/}\n            {/*    x={this.state.playerPosition.x}*/}\n            {/*    y={this.state.playerPosition.y}*/}\n            {/*    playerPosition={this.state.playerPosition} size={this.props.size}/>*/}\n            <KeyboardEventHandler\n                handleKeys={[\"left\", \"right\", \"up\", \"down\", \"w\", \"a\", \"s\", \"d\"]}\n                onKeyEvent={(key, e) => {\n                    this.debouncedMovePlayer(key, e, 100)\n                }}\n            />\n            { this.props.children }\n        </>\n    }\n}\n\nexport default Player","import React from \"react\";\nimport {hostname, http_prefix} from \"../utils\";\n\nclass Square extends React.Component {\n\n    isSolid(){\n        return this.props.pixel.g > 180\n    }\n\n    render() {\n        let p = this.props.pixel\n        let color = `rgb(${p.r}, ${p.g}, ${p.b})`\n        if (this.isSolid()) {\n            color = `rgb(0, 80, 0)`\n        }\n        return <div style={{\n                width: \"50px\",\n                height: \"50px\",\n                left: `${50*(p.x-this.props.chunkPosition.x)}px`,\n                top: `${50*(p.y-this.props.chunkPosition.y)}px`,\n                backgroundColor: color,\n                position: \"absolute\"\n            }}>\n                {/*({p.x}, {p.y})*/}\n            </div>\n    }\n}\n\nclass Chunk extends React.Component {\n    SIZE = 50;\n    chunk = {}\n    state = {}\n\n    backgroundSquares() {\n        let pixels = []\n        // if(this.chunk.pixels === null || this.chunk.pixels === undefined) { return [] }\n        this.props.data.pixels.forEach(pixel => {\n\n            pixels.push(<Square\n                key={pixel.x+\"_\"+pixel.y}\n                pixel={pixel}\n                chunkPosition={{x:this.props.data.x, y:this.props.data.y}}\n                playerPosition={this.props.playerPosition}\n            />)\n        })\n        return pixels\n    }\n\n    render() {\n        let x = this.props.x\n        let y = this.props.y\n        let size = 50;\n        let squaresTall = Math.ceil(window.innerHeight/size);\n        let squaresWide = Math.ceil(window.innerWidth/size);\n        let offsetX = -this.props.playerPosition.x + Math.floor(squaresWide/2)\n        let offsetY = -this.props.playerPosition.y + Math.floor(squaresTall/2)\n\n        return <div className=\"chunk\" style={{\n            // zIndex: \"0\",\n            position: \"absolute\",\n            border:\"solid thin black\",\n            width: `${this.SIZE*this.chunk.size}px`,\n            height: `${this.SIZE*this.chunk.size}px`,\n            backgroundColor: \"pink\",\n            left: size*(x+offsetX)+\"px\",\n            top: size*(y+offsetY)+\"px\",\n\n        }}>\n            <div className=\"squares\">{this.backgroundSquares()}</div>\n        </div>\n    }\n}\n\nclass Background extends React.Component {\n\n    CHUNKSIZE = 10\n\n    state = {\n        playerPosition: {x:-99, y:-99},\n        chunkData: {},\n    }\n\n    componentDidMount(props) {\n        this.updateChunks()\n    }\n\n    requestChunk(x, y) {\n        if (this.state.chunkData[`${x}_${y}`] !== undefined ){\n            return\n        }\n\n        // so we don't request again\n        let state = this.state\n        state.chunkData[`${x}_${y}`] = {pixels:[], objects:[]}\n        this.setState(state)\n\n        let url = `${http_prefix()}://${hostname()}/chunks?x=${x}&y=${y}`\n        fetch(url)\n            .then(res => res.json())\n            .then(chunkData => {\n                let state = this.state\n                state.chunkData[`${x}_${y}`] = chunkData\n                this.setState(state)\n            });\n    }\n\n    updateChunks(){\n        let size = 50;\n        let squaresTall = Math.ceil(window.innerHeight/size);\n        let squaresWide = Math.ceil(window.innerWidth/size);\n\n        let pp = this.playerPosition()\n        let minX = Math.floor(pp.x - squaresWide/2)\n        let minY = Math.floor(pp.y - squaresTall/2)\n        let maxX = Math.ceil(pp.x + squaresWide/2)\n        let maxY = Math.ceil(pp.y + squaresTall/2)\n\n        minX = minX - minX%this.CHUNKSIZE - this.CHUNKSIZE\n        minY = minY - minY%this.CHUNKSIZE - this.CHUNKSIZE\n        maxX = maxX + maxX%this.CHUNKSIZE + this.CHUNKSIZE\n        maxY = maxY + maxY%this.CHUNKSIZE + this.CHUNKSIZE\n\n        let chunksWide = Math.ceil((maxX-minX)/this.CHUNKSIZE)\n        let chunksTall = Math.ceil((maxY-minY)/this.CHUNKSIZE)\n\n        let xIndex = [...Array(chunksWide).keys()]\n        let yIndex = [...Array(chunksTall).keys()]\n        xIndex.forEach(x => {\n            yIndex.forEach(y => {\n                if (this.state.chunkData[`${x}_${y}`] === undefined ){\n                    this.requestChunk(minX+x*this.CHUNKSIZE,minY+y*this.CHUNKSIZE)\n                }\n           })\n        })\n    }\n\n    playerPosition() {\n        return this.props.app.playerPosition()\n    }\n\n    isSolidAt(p){\n\n        let x = Math.floor(p.x/this.CHUNKSIZE)*this.CHUNKSIZE\n        let y = Math.floor(p.y/this.CHUNKSIZE)*this.CHUNKSIZE\n        let chunk = this.state.chunkData[`${x}_${y}`]\n        if(chunk === undefined) {\n            return false\n        }\n        let solid = false\n\n        chunk.pixels.forEach(pixel => {\n            if(Math.ceil(p.x) === pixel.x && Math.ceil(p.y) === pixel.y){\n                if(pixel.g > 180){\n                    solid = true\n                }\n            }\n        })\n\n        // chunk.objects.forEach(object => {\n        //     if(Math.ceil(p.x) === object.x && Math.ceil(p.y) === object.y){\n        //          if(object.solid){\n        //             solid = true\n        //         }\n        //     }\n        // })\n\n        return solid\n    }\n\n    render() {\n        let chunks = [];\n        let keys = Object.keys(this.state.chunkData)\n        keys.forEach(key => {\n            let chunkData = this.state.chunkData[key]\n            let chunk = <Chunk\n                x={chunkData.x}\n                y={chunkData.y}\n                key={key}\n                playerPosition={this.playerPosition()}\n                data={chunkData}\n                objectEventBus={this.props.objectEventBus}\n            />;\n            chunks.push(chunk)\n        })\n\n        return (<div id=\"chunks\">\n            {chunks}\n        </div>);\n    }\n}\n\nexport default Background","import React from \"react\";\nimport {hostname, http_prefix} from \"../utils\";\n\nclass GameObject extends React.Component {\n\n    state = {\n        object: {x:0, y:0}\n    }\n\n    isSolid(){\n        return this.props.object.solid\n    }\n\n    constructor(props) {\n        super(props);\n        this.state.object = props.object\n    }\n\n    componentDidMount(){\n        this.props.objectEventBus.on(\"object-update\", object => {\n            if(this.props.id === object.id){\n                let state = this.state\n                state.object = object\n                this.setState(state)\n            }\n        })\n    }\n\n    render() {\n        let p = this.state.object\n        let s = this.props.size\n        let x = p.x\n        let y = p.y\n        let size = 50;\n        let squaresTall = Math.ceil(window.innerHeight/size);\n        let squaresWide = Math.ceil(window.innerWidth/size);\n        let offsetX = -this.props.playerPosition.x + Math.floor(squaresWide/2)\n        let offsetY = -this.props.playerPosition.y + Math.floor(squaresTall/2)\n\n        let images = []\n        p.images.forEach(src => {\n            images.push(<img style={{\n                width: `${s}px`,\n                height: `${s}px`,\n                position: \"absolute\",\n                left: \"0px\",\n                top: \"0px\",\n            }}\n                 key={`${p.id}_img_${images.length}`}\n                 src={`${http_prefix()}://${hostname()}${src}`}\n                 alt={this.props.object.type}\n            />)\n\n        })\n        return <div style={{\n            position: \"absolute\",\n            width: s+\"px\",\n            height: s+\"px\",\n            zIndex: this.props.zIndex,\n            left:s*(x+offsetX)+\"px\",\n            top:s*(y+offsetY)+\"px\",\n        }}>\n            {images}\n        </div>\n    }\n}\n\nclass Objects extends React.Component {\n    SIZE = 50\n\n    state = {\n        objects: {}\n    }\n\n    componentDidMount(){\n        this.props.objectEventBus.on(\"object-update\", object => {\n            console.log(\"update:\", object)\n            let state = this.state\n            if (object.action === \"remove\") {\n                delete state.objects[object.id]\n            } else {\n                state.objects[object.id] = object\n            }\n            this.setState(state)\n        })\n    }\n\n    isSolidAt(p){\n        let solid = false\n        Object.values(this.state.objects).forEach(object => {\n            if(Math.ceil(p.x) === object.x && Math.ceil(p.y) === object.y){\n                 if(object.solid){\n                     solid = true\n                }\n            }\n        })\n\n        return solid\n    }\n\n    render() {\n\n        let playerPosition = {x:0, y:0}\n        if(this.props.player.current !== null){\n            playerPosition = this.props.player.current.state.playerPosition\n        }\n\n        let objects = [];\n        Object.values(this.state.objects).forEach(o => {\n            objects.push(<GameObject\n                object={o}\n                key={o.id}\n                id={o.id}\n                size={this.SIZE}\n                objectEventBus={this.props.objectEventBus}\n                playerPosition={playerPosition}\n            />)\n        })\n        return <div className=\"objects\">\n            {objects}\n        </div>\n    }\n\n\n}\n\nexport default Objects","import React from \"react\";\nimport {hostname, ws_prefix} from \"../utils\";\n\nconst { v4: uuidv4 } = require('uuid');\n\nclass ChatMessage extends React.Component {\n\n    render(){\n        return <div className=\"chat_message\" style={{color:\"white\"}}>{this.props.message.from.substr(1, 6)}: {this.props.message.message}</div>\n    }\n}\n\nclass Chat extends React.Component {\n    id = uuidv4();\n    ws = new WebSocket(`${ws_prefix()}://${hostname()}/chat`)\n    state = {\n        messages: [],\n        text: \"\",\n    }\n\n    componentDidMount() {\n        this.ws.onopen = () => {\n            // on connecting, do nothing but log it to the console\n            this.ws.send(`{\"id\":\"${this.id}\", \"message\":\"logged in\"}`)\n        }\n\n        this.ws.onmessage = evt => {\n            // on receiving a message, add it to the list of messages\n            const message = JSON.parse(evt.data)\n            let state = this.state\n            state.messages.push(message)\n            this.setState(state)\n        }\n\n        this.ws.onclose = () => {\n            console.log('disconnected')\n        }\n    }\n\n    sendMessage(e, msg){\n        e.preventDefault();\n        console.log(this.state.text)\n        this.ws.send(`{\"id\":\"${this.id}\", \"message\":\"${this.state.text}\"}`)\n        let state = this.state\n        state.text = \"\"\n        this.setState(state)\n    }\n\n    textChange(event) {\n        let state = this.state\n        state.text = event.target.value\n        this.setState(state)\n    }\n\n    render(){\n        let messages = [];\n        this.state.messages.forEach((msg, i) => {\n            messages.push(<ChatMessage key={`msg_${i}`} message={msg} />)\n        })\n\n        return <div style={{\n            width:\"300px\",\n            height:\"500px\",\n            backgroundColor: \"rgba(20,20,20,0.8)\",\n            position: \"absolute\",\n            top: \"10px\",\n            left: \"10px\",\n        }} >\n            <div style={{color:\"white\"}}>you are {this.id.substr(1, 6)}</div>\n            <div>\n                {messages}\n            </div>\n            <form onSubmit={this.sendMessage.bind(this)}>\n                <input type=\"text\"\n                       style={{\n                           bottom: \"6px\",\n                           left: \"5px\",\n                           width: \"185px\",\n                           position: \"absolute\"\n                       }}\n                       onChange={this.textChange.bind(this)}\n                       value={this.state.text}\n                />\n            </form>\n        </div>\n    }\n}\n\nexport default Chat","import React from 'react';\nimport './App.css';\nimport Player from \"./components/player\";\nimport Background from \"./components/background\";\nimport Objects from \"./components/objects\";\nimport Chat from \"./components/chat\";\n\n\nclass App extends React.Component {\n\n    state = {}\n\n    constructor(props) {\n        super(props);\n        this.background = React.createRef();\n        this.objects = React.createRef();\n        this.player = React.createRef();\n        this.objectEventBus = require('js-event-bus')();\n    }\n\n    playerPosition() {\n        if(this.player.current===null){\n            return {x:0, y:0}\n        }\n        return this.player.current.state.playerPosition\n    }\n\n    render() {\n        let size = 50;\n        return <div>\n            <Player size={size} background={this.background} objects={this.objects} ref={this.player} app={this} objectEventBus={this.objectEventBus} />\n            <Background size={size} ref={this.background} app={this}/>\n            <Objects size={size} objectEventBus={this.objectEventBus} player={this.player} ref={this.objects} />\n            <Chat/>\n        </div>;\n    }\n\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}